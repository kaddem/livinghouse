$(document).ready(function(){

  // бургер, что тут еще скажешь? но без колы(
  $('.burger').on('click', function(e){
      e.preventDefault();
      if ( $(this).hasClass("burger--close") ) {
          $(this).removeClass('burger--close');
          $('.main-nav').slideUp(400);
          $('.main-nav').removeClass('main-nav--open');
          $('.page-header').removeClass('page-header--open');
      } else {
          $(this).addClass('burger--close');
          $('.main-nav').slideDown(400);
          $('.main-nav').addClass('main-nav--open');
          $('.page-header').addClass('page-header--open');
      }
  });

  $('.nav ul a').on('click', function(e){
      if ($(window).width() < 768) {
          $('.main-nav').slideUp(400);
          $('.burger').addClass('burger--open');
          $('.burger').removeClass('burger--close');
      };
  });


  $(window).resize(function(){
      if( $(window).width() > 767 ) {
          $('.main-nav').show();
      } else {
          $('.main-nav').slideUp(400);
          $('.main-nav').removeClass('main-nav--open');
          $('.page-header').removeClass('page-header--open');
          $('.burger').removeClass('burger--close');
      }
  });

  $(window).on('scroll', function(e) { // отслеживаем событие на элементе window
    if( $(window).width() < 768 ) {
        $('.main-nav').slideUp(400);
        $('.main-nav').removeClass('main-nav--open');
        $('.page-header').removeClass('page-header--open');
        $('.burger').removeClass('burger--close');
    }
  });

  if ( $(window).scrollTop() > 100 && $(window).width() > 767) {
    $('.page-header').addClass('page-header--scroll');
    $('.page-header').addClass('page-header--desktop');
  } else if ( $(window).scrollTop() > 100 ) {
    $('.page-header').addClass('page-header--scroll');
  }

  $(window).on('scroll', function(e) {

    if ( $(window).scrollTop() > 100 && $(window).width() > 1199 ) {
      $('.page-header').addClass('page-header--scroll');
      $('.page-header').addClass('page-header--desktop');
    } else if ( $(window).scrollTop() > 100 ) {
      $('.page-header').addClass('page-header--scroll');
      $('.page-header').removeClass('page-header--desktop');
    } else {
      $('.page-header').removeClass('page-header--scroll');
      $('.page-header').removeClass('page-header--desktop');
    }

  });

});
$(document).ready(function(){

  $(function(){

    var dateEnd = $('#countdown-promo').data('timer-hours');
  
    var note = $('#note'),
      ts = new Date(2012, 0, 1),
      newYear = true;
    
    if((new Date()) > ts){
      // The new year is here! Count towards something else.
      // Notice the *1000 at the end - time must be in milliseconds
      ts = (new Date()).getTime() + dateEnd*24*60*60*1000;
      newYear = false;
    }


      
    $('#countdown-promo').countdown({
      timestamp : ts,
      callback  : function(days, hours, minutes, seconds){
        
        var message = "";
        
        message += days + " day" + ( days==1 ? '':'s' ) + ", ";
        message += hours + " hour" + ( hours==1 ? '':'s' ) + ", ";
        message += minutes + " minute" + ( minutes==1 ? '':'s' ) + " and ";
        message += seconds + " second" + ( seconds==1 ? '':'s' ) + " <br />";
        
        if(newYear){
          message += "left until the new year!";
        }
        else {
          message += "left to 10 days from now!";
        }
        
        note.html(message);
      }
    });
    
  });

});
$(document).ready(function(){

  // Закрытие дропдаунов по клику вне их

  function closeOutDropdown(dropDown, input) {

    $(document).mouseup(function (e){ // событие клика по веб-документу
      var drop = $(dropDown); // тут указываем ID элемента
      var inp = $(input);
      if (inp.is(e.target)) {
        return;
      } else if (!drop.is(e.target) // если клик был не по нашему блоку
          && drop.has(e.target).length === 0) { // и не по его дочерним элементам
        drop.hide(); // скрываем его
      } 
    });

  }

  closeOutDropdown('.form__dropdown', '.form__selected');
  closeOutDropdown('.projects-filter__dropdown', '.projects-filter__selected');
  closeOutDropdown('.form-review__dropdown', '.form-review__selected');

  function clickSelect(select, dropList){

    $(select).on('click', function(e){
    
      var dropDown = $(this).find(dropList);
      var everDropDown = $(dropList);
      
      if ( dropDown.is(':visible') ) {
        everDropDown.hide();
      } else if ( dropDown.is(':hidden') ) {
        everDropDown.hide();
        dropDown.show();
      } 
      
    });

  }

  clickSelect('.form__select', '.form__dropdown');
  clickSelect('.projects-filter__select', '.projects-filter__dropdown');
  clickSelect('.form-review__select', '.form-review__dropdown');

});
$(document).ready(function(){
  
  function closeOutDropdown(dropDown, input) {

      $(document).mouseup(function (e){ // событие клика по веб-документу
        
        if ( $('.project-form__value-list').hasClass('project-form__value-list--active')) {
          var drop = $(dropDown); // тут указываем ID элемента
          var inp = $(input);
          if (inp.is(e.target)) {
            return;
          } else if (!drop.is(e.target) // если клик был не по нашему блоку
              && drop.has(e.target).length === 0) { // и не по его дочерним элементам
            drop.removeClass('project-form__value-list--active'); // скрываем его
          } 
        }

      });

  }
  
  closeOutDropdown('.project-form__value-list', '.project-form__value-label');
  
  
  $('.project-form__value-label').on('click', function(){
    
    var inputId = $( this ).attr('for');
    var inputThis = $ ('#' + inputId );
    var parent = $( this ).parent();
    
    if ( inputThis.prop("checked") ) {
      $('.project-form__value-list').removeClass('project-form__value-list--active');
      $( parent ).addClass('project-form__value-list--active');
    } else {
      $( parent ).removeClass('project-form__value-list--active');
    }
    
  });
  
});
$(document).ready(function(){

  function tabs(boxTabsLink, boxTabsContent, tabs){ 
    $(boxTabsLink + ' input').on('click', function(e){
      var attrLink = $(this).attr('id');
      $(boxTabsContent + ' ' + tabs).css("display", "none");
      $(boxTabsContent + ' .' + attrLink).css("display", "block");
    }); 
  };


  tabs('#tabs-roof', '#tabs-roof-content', '.project-form__table-select--roof-content');
  tabs('#tabs-frame', '#tabs-frame-content', '.project-form__tab-item');

});
$(document).ready(function(){

  $('.promo-slider').slick({
    dots: true
    // autoplay: true,
    // autoplaySpeed: 500
  });

});
$(document).ready(function(){

  $('.project-form__plus-minus').on('click', function(){
    var thisElem = $(this);
    var input = $('.project-form__input-quant');
    var value = Number( input.val() );

    if ( value == 0 && $(thisElem).hasClass( 'project-form__plus-minus--plus' ) ) {
      value = value + 1;
      $(input).val(value);
    } else if ( value == 0 ){
      return;
    } else if ( $(thisElem).hasClass( 'project-form__plus-minus--plus' ) ){
      value = value + 1;
      $(input).val(value);
    } else {
      value = value - 1;
      $(input).val(value);
    }

  })


  $('.project-form__action-label').on('click', function(){

    var parent = $(this).parent();
    var check = $(parent).find('.project-form__action-check');

    if ( $(check).prop("checked") ) {
      $(this).text('Добавить');
    } else {
      $(this).text('Добавлено');
    }

  });

});
$(window).load(function() {

  function ratioPhoto(block) {
    $(block).each(function(){
      var itemWidth = $(this).width();
      var itemHeight = $(this).height();
      var itemRatio = itemHeight / itemWidth;

      var photo = $(this).find('img');
      var photoWidth = photo.width();
      var photoHeight = photo.height();
      var photoRatio = photoHeight / photoWidth;

      if ( itemRatio < photoRatio ) {
        photo.width('100%');
        photo.height('auto');
      } else if (itemRatio > photoRatio) {
        photo.height('100%');
        photo.width('auto');
      } else {
        photo.width('100%');
        photo.height('auto');
      }
    });
  }

  function ratioLetter(block) {
    $(block).each(function(){
      var itemWidth = $(this).width();
      var itemHeight = $(this).height();
      var itemRatio = itemHeight / itemWidth;

      var photo = $(this).find('img');
      var photoWidth = photo.width();
      var photoHeight = photo.height();
      var photoRatio = photoHeight / photoWidth;

      if ( itemRatio > photoRatio ) {
        photo.width('100%');
      } else if (itemRatio < photoRatio) {
        photo.height('100%');
      } else {
        photo.width('100%');
      }
    });
  }

  ratioPhoto('.review__slider-preview-item');
  ratioPhoto('.review__slider-big-item');
  ratioLetter('.review__letter-box');
  ratioLetter('.review__chart-box');
  ratioPhoto('.gallery__item');
  ratioPhoto('.project-card__photo');
  ratioPhoto('.review-card__visual');
  ratioPhoto('.project__photo');

  $(window).resize(function(){
    ratioPhoto('.review__slider-preview-item');
    ratioPhoto('.review__slider-big-item');
    ratioLetter('.review__letter-box');
    ratioLetter('.review__chart-box');
    ratioPhoto('.gallery__item');
    ratioPhoto('.project-card__photo');
    ratioPhoto('.review-card__visual');
    ratioPhoto('.project__photo');
  });

});
$(document).ready(function(){

  $('.review__slider-big').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    arrows: false,
    fade: true,
    asNavFor: '.review__slider-preview'
  });

  $('.review__slider-preview').slick({
    slidesToShow: 4,
    slidesToScroll: 1,
    asNavFor: '.review__slider-big',
    dots: false,
    centerMode: false,
    focusOnSelect: true,
    responsive: [
      {
        breakpoint: 1200,
        settings: {
          slidesToShow: 2
        }
      }
    ]
  });

});
$(document).ready(function(){
  // Ползунок для форм
  
  function sliderForm( inputStart, inputEnd, idSlider, dataStart, dataEnd ) {
    var priceStart = $(inputStart).data( dataStart );
    var priceEnd = $(inputEnd).data( dataEnd );

    $( idSlider ).slider({
      // orientation: "vertical",
      // step: 15,
      range: true,
      min: priceStart,
      max: priceEnd,
      values: [ priceStart, priceEnd ],
      slide: function( event, ui ) {
        $( inputStart ).val( ui.values[ 0 ] );
        $( inputEnd ).val( ui.values[ 1 ] );
      }
    });
    $( inputStart ).val( $( idSlider ).slider( "values", 0 ) );
    $( inputEnd ).val( $( idSlider ).slider( "values", 1 ) );

    // Изменение местоположения ползунка при вводиде данных в первый элемент input
    $( inputStart ).change(function(){
      var value1=$( inputStart ).val();
      var value2=$( inputEnd ).val();

      if (parseInt(value1) > parseInt(value2)){
        value1 = value2;
        $( inputStart ).val(value1);
      }
      $(idSlider).slider("values",0,value1); 
    });
        
    // Изменение местоположения ползунка при вводиде данных в второй элемент input  
    $( inputEnd ).change(function(){
      var value1=$( inputStart ).val();
      var value2=$( inputEnd ).val();

      if(parseInt(value1) > parseInt(value2)){
        value2 = value1;
        $( inputEnd ).val(value2);
      }
      $(idSlider).slider("values",1,value2);
    });

    // фильтрация ввода в поля
    jQuery('#amount_start, #amount_end').keypress(function(event){
      var key, keyChar;
      if(!event) var event = window.event;
      
      if (event.keyCode) key = event.keyCode;
      else if(event.which) key = event.which;
    
      if(key==null || key==0 || key==8 || key==13 || key==9 || key==46 || key==37 || key==39 ) return true;
      keyChar=String.fromCharCode(key);
      
      if(!/\d/.test(keyChar)) return false;
    
    });

  }

  sliderForm('.projects-filter__cost--start', '.projects-filter__cost--end', '#project-slider-ui', 'proj-start', 'proj-end');
  sliderForm('.form__cost--start', '.form__cost--end', '#form-slider-ui', 'price-start', 'price-end');

});
$(document).ready(function(){

  function telMask(selector) {
    $(selector).mask('+7 (000) 000-00-00');
  }

  telMask('.contact-form__input--tel');
  telMask('.consult__input-tel');

});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1cmdlci5qcyIsImNvdW50ZG93bi5qcyIsImRyb3Bkb3duLWZpbHRlci5qcyIsImRyb3Bkb3duLXByb2plY3QuanMiLCJwcm9qZWN0LXRhYnMuanMiLCJwcm9tby1zbGlkZXIuanMiLCJxdWFudGl0eS1wcm9qZWN0LmpzIiwicmF0aW8tcGhvdG8uanMiLCJyZXZpZXctc2xpZGVyLmpzIiwic2xpZGVyLWZvcm0uanMiLCJ0ZWwtbWFzay5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoic2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG4gIC8vINCx0YPRgNCz0LXRgCwg0YfRgtC+INGC0YPRgiDQtdGJ0LUg0YHQutCw0LbQtdGI0Yw/INC90L4g0LHQtdC3INC60L7Qu9GLKFxyXG4gICQoJy5idXJnZXInKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBpZiAoICQodGhpcykuaGFzQ2xhc3MoXCJidXJnZXItLWNsb3NlXCIpICkge1xyXG4gICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYnVyZ2VyLS1jbG9zZScpO1xyXG4gICAgICAgICAgJCgnLm1haW4tbmF2Jykuc2xpZGVVcCg0MDApO1xyXG4gICAgICAgICAgJCgnLm1haW4tbmF2JykucmVtb3ZlQ2xhc3MoJ21haW4tbmF2LS1vcGVuJyk7XHJcbiAgICAgICAgICAkKCcucGFnZS1oZWFkZXInKS5yZW1vdmVDbGFzcygncGFnZS1oZWFkZXItLW9wZW4nKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2J1cmdlci0tY2xvc2UnKTtcclxuICAgICAgICAgICQoJy5tYWluLW5hdicpLnNsaWRlRG93big0MDApO1xyXG4gICAgICAgICAgJCgnLm1haW4tbmF2JykuYWRkQ2xhc3MoJ21haW4tbmF2LS1vcGVuJyk7XHJcbiAgICAgICAgICAkKCcucGFnZS1oZWFkZXInKS5hZGRDbGFzcygncGFnZS1oZWFkZXItLW9wZW4nKTtcclxuICAgICAgfVxyXG4gIH0pO1xyXG5cclxuICAkKCcubmF2IHVsIGEnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpIDwgNzY4KSB7XHJcbiAgICAgICAgICAkKCcubWFpbi1uYXYnKS5zbGlkZVVwKDQwMCk7XHJcbiAgICAgICAgICAkKCcuYnVyZ2VyJykuYWRkQ2xhc3MoJ2J1cmdlci0tb3BlbicpO1xyXG4gICAgICAgICAgJCgnLmJ1cmdlcicpLnJlbW92ZUNsYXNzKCdidXJnZXItLWNsb3NlJyk7XHJcbiAgICAgIH07XHJcbiAgfSk7XHJcblxyXG5cclxuICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCl7XHJcbiAgICAgIGlmKCAkKHdpbmRvdykud2lkdGgoKSA+IDc2NyApIHtcclxuICAgICAgICAgICQoJy5tYWluLW5hdicpLnNob3coKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICQoJy5tYWluLW5hdicpLnNsaWRlVXAoNDAwKTtcclxuICAgICAgICAgICQoJy5tYWluLW5hdicpLnJlbW92ZUNsYXNzKCdtYWluLW5hdi0tb3BlbicpO1xyXG4gICAgICAgICAgJCgnLnBhZ2UtaGVhZGVyJykucmVtb3ZlQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1vcGVuJyk7XHJcbiAgICAgICAgICAkKCcuYnVyZ2VyJykucmVtb3ZlQ2xhc3MoJ2J1cmdlci0tY2xvc2UnKTtcclxuICAgICAgfVxyXG4gIH0pO1xyXG5cclxuICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKGUpIHsgLy8g0L7RgtGB0LvQtdC20LjQstCw0LXQvCDRgdC+0LHRi9GC0LjQtSDQvdCwINGN0LvQtdC80LXQvdGC0LUgd2luZG93XHJcbiAgICBpZiggJCh3aW5kb3cpLndpZHRoKCkgPCA3NjggKSB7XHJcbiAgICAgICAgJCgnLm1haW4tbmF2Jykuc2xpZGVVcCg0MDApO1xyXG4gICAgICAgICQoJy5tYWluLW5hdicpLnJlbW92ZUNsYXNzKCdtYWluLW5hdi0tb3BlbicpO1xyXG4gICAgICAgICQoJy5wYWdlLWhlYWRlcicpLnJlbW92ZUNsYXNzKCdwYWdlLWhlYWRlci0tb3BlbicpO1xyXG4gICAgICAgICQoJy5idXJnZXInKS5yZW1vdmVDbGFzcygnYnVyZ2VyLS1jbG9zZScpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBpZiAoICQod2luZG93KS5zY3JvbGxUb3AoKSA+IDEwMCAmJiAkKHdpbmRvdykud2lkdGgoKSA+IDc2Nykge1xyXG4gICAgJCgnLnBhZ2UtaGVhZGVyJykuYWRkQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1zY3JvbGwnKTtcclxuICAgICQoJy5wYWdlLWhlYWRlcicpLmFkZENsYXNzKCdwYWdlLWhlYWRlci0tZGVza3RvcCcpO1xyXG4gIH0gZWxzZSBpZiAoICQod2luZG93KS5zY3JvbGxUb3AoKSA+IDEwMCApIHtcclxuICAgICQoJy5wYWdlLWhlYWRlcicpLmFkZENsYXNzKCdwYWdlLWhlYWRlci0tc2Nyb2xsJyk7XHJcbiAgfVxyXG5cclxuICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICBpZiAoICQod2luZG93KS5zY3JvbGxUb3AoKSA+IDEwMCAmJiAkKHdpbmRvdykud2lkdGgoKSA+IDExOTkgKSB7XHJcbiAgICAgICQoJy5wYWdlLWhlYWRlcicpLmFkZENsYXNzKCdwYWdlLWhlYWRlci0tc2Nyb2xsJyk7XHJcbiAgICAgICQoJy5wYWdlLWhlYWRlcicpLmFkZENsYXNzKCdwYWdlLWhlYWRlci0tZGVza3RvcCcpO1xyXG4gICAgfSBlbHNlIGlmICggJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gMTAwICkge1xyXG4gICAgICAkKCcucGFnZS1oZWFkZXInKS5hZGRDbGFzcygncGFnZS1oZWFkZXItLXNjcm9sbCcpO1xyXG4gICAgICAkKCcucGFnZS1oZWFkZXInKS5yZW1vdmVDbGFzcygncGFnZS1oZWFkZXItLWRlc2t0b3AnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICQoJy5wYWdlLWhlYWRlcicpLnJlbW92ZUNsYXNzKCdwYWdlLWhlYWRlci0tc2Nyb2xsJyk7XHJcbiAgICAgICQoJy5wYWdlLWhlYWRlcicpLnJlbW92ZUNsYXNzKCdwYWdlLWhlYWRlci0tZGVza3RvcCcpO1xyXG4gICAgfVxyXG5cclxuICB9KTtcclxuXHJcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG4gICQoZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgZGF0ZUVuZCA9ICQoJyNjb3VudGRvd24tcHJvbW8nKS5kYXRhKCd0aW1lci1ob3VycycpO1xyXG4gIFxyXG4gICAgdmFyIG5vdGUgPSAkKCcjbm90ZScpLFxyXG4gICAgICB0cyA9IG5ldyBEYXRlKDIwMTIsIDAsIDEpLFxyXG4gICAgICBuZXdZZWFyID0gdHJ1ZTtcclxuICAgIFxyXG4gICAgaWYoKG5ldyBEYXRlKCkpID4gdHMpe1xyXG4gICAgICAvLyBUaGUgbmV3IHllYXIgaXMgaGVyZSEgQ291bnQgdG93YXJkcyBzb21ldGhpbmcgZWxzZS5cclxuICAgICAgLy8gTm90aWNlIHRoZSAqMTAwMCBhdCB0aGUgZW5kIC0gdGltZSBtdXN0IGJlIGluIG1pbGxpc2Vjb25kc1xyXG4gICAgICB0cyA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyBkYXRlRW5kKjI0KjYwKjYwKjEwMDA7XHJcbiAgICAgIG5ld1llYXIgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgICBcclxuICAgICQoJyNjb3VudGRvd24tcHJvbW8nKS5jb3VudGRvd24oe1xyXG4gICAgICB0aW1lc3RhbXAgOiB0cyxcclxuICAgICAgY2FsbGJhY2sgIDogZnVuY3Rpb24oZGF5cywgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpe1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBtZXNzYWdlID0gXCJcIjtcclxuICAgICAgICBcclxuICAgICAgICBtZXNzYWdlICs9IGRheXMgKyBcIiBkYXlcIiArICggZGF5cz09MSA/ICcnOidzJyApICsgXCIsIFwiO1xyXG4gICAgICAgIG1lc3NhZ2UgKz0gaG91cnMgKyBcIiBob3VyXCIgKyAoIGhvdXJzPT0xID8gJyc6J3MnICkgKyBcIiwgXCI7XHJcbiAgICAgICAgbWVzc2FnZSArPSBtaW51dGVzICsgXCIgbWludXRlXCIgKyAoIG1pbnV0ZXM9PTEgPyAnJzoncycgKSArIFwiIGFuZCBcIjtcclxuICAgICAgICBtZXNzYWdlICs9IHNlY29uZHMgKyBcIiBzZWNvbmRcIiArICggc2Vjb25kcz09MSA/ICcnOidzJyApICsgXCIgPGJyIC8+XCI7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYobmV3WWVhcil7XHJcbiAgICAgICAgICBtZXNzYWdlICs9IFwibGVmdCB1bnRpbCB0aGUgbmV3IHllYXIhXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgbWVzc2FnZSArPSBcImxlZnQgdG8gMTAgZGF5cyBmcm9tIG5vdyFcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgbm90ZS5odG1sKG1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIFxyXG4gIH0pO1xyXG5cclxufSk7IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuXHJcbiAgLy8g0JfQsNC60YDRi9GC0LjQtSDQtNGA0L7Qv9C00LDRg9C90L7QsiDQv9C+INC60LvQuNC60YMg0LLQvdC1INC40YVcclxuXHJcbiAgZnVuY3Rpb24gY2xvc2VPdXREcm9wZG93bihkcm9wRG93biwgaW5wdXQpIHtcclxuXHJcbiAgICAkKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uIChlKXsgLy8g0YHQvtCx0YvRgtC40LUg0LrQu9C40LrQsCDQv9C+INCy0LXQsS3QtNC+0LrRg9C80LXQvdGC0YNcclxuICAgICAgdmFyIGRyb3AgPSAkKGRyb3BEb3duKTsgLy8g0YLRg9GCINGD0LrQsNC30YvQstCw0LXQvCBJRCDRjdC70LXQvNC10L3RgtCwXHJcbiAgICAgIHZhciBpbnAgPSAkKGlucHV0KTtcclxuICAgICAgaWYgKGlucC5pcyhlLnRhcmdldCkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH0gZWxzZSBpZiAoIWRyb3AuaXMoZS50YXJnZXQpIC8vINC10YHQu9C4INC60LvQuNC6INCx0YvQuyDQvdC1INC/0L4g0L3QsNGI0LXQvNGDINCx0LvQvtC60YNcclxuICAgICAgICAgICYmIGRyb3AuaGFzKGUudGFyZ2V0KS5sZW5ndGggPT09IDApIHsgLy8g0Lgg0L3QtSDQv9C+INC10LPQviDQtNC+0YfQtdGA0L3QuNC8INGN0LvQtdC80LXQvdGC0LDQvFxyXG4gICAgICAgIGRyb3AuaGlkZSgpOyAvLyDRgdC60YDRi9Cy0LDQtdC8INC10LPQvlxyXG4gICAgICB9IFxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgY2xvc2VPdXREcm9wZG93bignLmZvcm1fX2Ryb3Bkb3duJywgJy5mb3JtX19zZWxlY3RlZCcpO1xyXG4gIGNsb3NlT3V0RHJvcGRvd24oJy5wcm9qZWN0cy1maWx0ZXJfX2Ryb3Bkb3duJywgJy5wcm9qZWN0cy1maWx0ZXJfX3NlbGVjdGVkJyk7XHJcbiAgY2xvc2VPdXREcm9wZG93bignLmZvcm0tcmV2aWV3X19kcm9wZG93bicsICcuZm9ybS1yZXZpZXdfX3NlbGVjdGVkJyk7XHJcblxyXG4gIGZ1bmN0aW9uIGNsaWNrU2VsZWN0KHNlbGVjdCwgZHJvcExpc3Qpe1xyXG5cclxuICAgICQoc2VsZWN0KS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgIFxyXG4gICAgICB2YXIgZHJvcERvd24gPSAkKHRoaXMpLmZpbmQoZHJvcExpc3QpO1xyXG4gICAgICB2YXIgZXZlckRyb3BEb3duID0gJChkcm9wTGlzdCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoIGRyb3BEb3duLmlzKCc6dmlzaWJsZScpICkge1xyXG4gICAgICAgIGV2ZXJEcm9wRG93bi5oaWRlKCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoIGRyb3BEb3duLmlzKCc6aGlkZGVuJykgKSB7XHJcbiAgICAgICAgZXZlckRyb3BEb3duLmhpZGUoKTtcclxuICAgICAgICBkcm9wRG93bi5zaG93KCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIFxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgY2xpY2tTZWxlY3QoJy5mb3JtX19zZWxlY3QnLCAnLmZvcm1fX2Ryb3Bkb3duJyk7XHJcbiAgY2xpY2tTZWxlY3QoJy5wcm9qZWN0cy1maWx0ZXJfX3NlbGVjdCcsICcucHJvamVjdHMtZmlsdGVyX19kcm9wZG93bicpO1xyXG4gIGNsaWNrU2VsZWN0KCcuZm9ybS1yZXZpZXdfX3NlbGVjdCcsICcuZm9ybS1yZXZpZXdfX2Ryb3Bkb3duJyk7XHJcblxyXG59KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xyXG4gIFxyXG4gIGZ1bmN0aW9uIGNsb3NlT3V0RHJvcGRvd24oZHJvcERvd24sIGlucHV0KSB7XHJcblxyXG4gICAgICAkKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uIChlKXsgLy8g0YHQvtCx0YvRgtC40LUg0LrQu9C40LrQsCDQv9C+INCy0LXQsS3QtNC+0LrRg9C80LXQvdGC0YNcclxuICAgICAgICBcclxuICAgICAgICBpZiAoICQoJy5wcm9qZWN0LWZvcm1fX3ZhbHVlLWxpc3QnKS5oYXNDbGFzcygncHJvamVjdC1mb3JtX192YWx1ZS1saXN0LS1hY3RpdmUnKSkge1xyXG4gICAgICAgICAgdmFyIGRyb3AgPSAkKGRyb3BEb3duKTsgLy8g0YLRg9GCINGD0LrQsNC30YvQstCw0LXQvCBJRCDRjdC70LXQvNC10L3RgtCwXHJcbiAgICAgICAgICB2YXIgaW5wID0gJChpbnB1dCk7XHJcbiAgICAgICAgICBpZiAoaW5wLmlzKGUudGFyZ2V0KSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKCFkcm9wLmlzKGUudGFyZ2V0KSAvLyDQtdGB0LvQuCDQutC70LjQuiDQsdGL0Lsg0L3QtSDQv9C+INC90LDRiNC10LzRgyDQsdC70L7QutGDXHJcbiAgICAgICAgICAgICAgJiYgZHJvcC5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMCkgeyAvLyDQuCDQvdC1INC/0L4g0LXQs9C+INC00L7Rh9C10YDQvdC40Lwg0Y3Qu9C10LzQtdC90YLQsNC8XHJcbiAgICAgICAgICAgIGRyb3AucmVtb3ZlQ2xhc3MoJ3Byb2plY3QtZm9ybV9fdmFsdWUtbGlzdC0tYWN0aXZlJyk7IC8vINGB0LrRgNGL0LLQsNC10Lwg0LXQs9C+XHJcbiAgICAgICAgICB9IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pO1xyXG5cclxuICB9XHJcbiAgXHJcbiAgY2xvc2VPdXREcm9wZG93bignLnByb2plY3QtZm9ybV9fdmFsdWUtbGlzdCcsICcucHJvamVjdC1mb3JtX192YWx1ZS1sYWJlbCcpO1xyXG4gIFxyXG4gIFxyXG4gICQoJy5wcm9qZWN0LWZvcm1fX3ZhbHVlLWxhYmVsJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgIFxyXG4gICAgdmFyIGlucHV0SWQgPSAkKCB0aGlzICkuYXR0cignZm9yJyk7XHJcbiAgICB2YXIgaW5wdXRUaGlzID0gJCAoJyMnICsgaW5wdXRJZCApO1xyXG4gICAgdmFyIHBhcmVudCA9ICQoIHRoaXMgKS5wYXJlbnQoKTtcclxuICAgIFxyXG4gICAgaWYgKCBpbnB1dFRoaXMucHJvcChcImNoZWNrZWRcIikgKSB7XHJcbiAgICAgICQoJy5wcm9qZWN0LWZvcm1fX3ZhbHVlLWxpc3QnKS5yZW1vdmVDbGFzcygncHJvamVjdC1mb3JtX192YWx1ZS1saXN0LS1hY3RpdmUnKTtcclxuICAgICAgJCggcGFyZW50ICkuYWRkQ2xhc3MoJ3Byb2plY3QtZm9ybV9fdmFsdWUtbGlzdC0tYWN0aXZlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAkKCBwYXJlbnQgKS5yZW1vdmVDbGFzcygncHJvamVjdC1mb3JtX192YWx1ZS1saXN0LS1hY3RpdmUnKTtcclxuICAgIH1cclxuICAgIFxyXG4gIH0pO1xyXG4gIFxyXG59KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xyXG5cclxuICBmdW5jdGlvbiB0YWJzKGJveFRhYnNMaW5rLCBib3hUYWJzQ29udGVudCwgdGFicyl7IFxyXG4gICAgJChib3hUYWJzTGluayArICcgaW5wdXQnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgdmFyIGF0dHJMaW5rID0gJCh0aGlzKS5hdHRyKCdpZCcpO1xyXG4gICAgICAkKGJveFRhYnNDb250ZW50ICsgJyAnICsgdGFicykuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICQoYm94VGFic0NvbnRlbnQgKyAnIC4nICsgYXR0ckxpbmspLmNzcyhcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcclxuICAgIH0pOyBcclxuICB9O1xyXG5cclxuXHJcbiAgdGFicygnI3RhYnMtcm9vZicsICcjdGFicy1yb29mLWNvbnRlbnQnLCAnLnByb2plY3QtZm9ybV9fdGFibGUtc2VsZWN0LS1yb29mLWNvbnRlbnQnKTtcclxuICB0YWJzKCcjdGFicy1mcmFtZScsICcjdGFicy1mcmFtZS1jb250ZW50JywgJy5wcm9qZWN0LWZvcm1fX3RhYi1pdGVtJyk7XHJcblxyXG59KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xyXG5cclxuICAkKCcucHJvbW8tc2xpZGVyJykuc2xpY2soe1xyXG4gICAgZG90czogdHJ1ZVxyXG4gICAgLy8gYXV0b3BsYXk6IHRydWUsXHJcbiAgICAvLyBhdXRvcGxheVNwZWVkOiA1MDBcclxuICB9KTtcclxuXHJcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG4gICQoJy5wcm9qZWN0LWZvcm1fX3BsdXMtbWludXMnKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHRoaXNFbGVtID0gJCh0aGlzKTtcclxuICAgIHZhciBpbnB1dCA9ICQoJy5wcm9qZWN0LWZvcm1fX2lucHV0LXF1YW50Jyk7XHJcbiAgICB2YXIgdmFsdWUgPSBOdW1iZXIoIGlucHV0LnZhbCgpICk7XHJcblxyXG4gICAgaWYgKCB2YWx1ZSA9PSAwICYmICQodGhpc0VsZW0pLmhhc0NsYXNzKCAncHJvamVjdC1mb3JtX19wbHVzLW1pbnVzLS1wbHVzJyApICkge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlICsgMTtcclxuICAgICAgJChpbnB1dCkudmFsKHZhbHVlKTtcclxuICAgIH0gZWxzZSBpZiAoIHZhbHVlID09IDAgKXtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfSBlbHNlIGlmICggJCh0aGlzRWxlbSkuaGFzQ2xhc3MoICdwcm9qZWN0LWZvcm1fX3BsdXMtbWludXMtLXBsdXMnICkgKXtcclxuICAgICAgdmFsdWUgPSB2YWx1ZSArIDE7XHJcbiAgICAgICQoaW5wdXQpLnZhbCh2YWx1ZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlIC0gMTtcclxuICAgICAgJChpbnB1dCkudmFsKHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgfSlcclxuXHJcblxyXG4gICQoJy5wcm9qZWN0LWZvcm1fX2FjdGlvbi1sYWJlbCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgdmFyIHBhcmVudCA9ICQodGhpcykucGFyZW50KCk7XHJcbiAgICB2YXIgY2hlY2sgPSAkKHBhcmVudCkuZmluZCgnLnByb2plY3QtZm9ybV9fYWN0aW9uLWNoZWNrJyk7XHJcblxyXG4gICAgaWYgKCAkKGNoZWNrKS5wcm9wKFwiY2hlY2tlZFwiKSApIHtcclxuICAgICAgJCh0aGlzKS50ZXh0KCfQlNC+0LHQsNCy0LjRgtGMJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAkKHRoaXMpLnRleHQoJ9CU0L7QsdCw0LLQu9C10L3QvicpO1xyXG4gICAgfVxyXG5cclxuICB9KTtcclxuXHJcbn0pOyIsIiQod2luZG93KS5sb2FkKGZ1bmN0aW9uKCkge1xyXG5cclxuICBmdW5jdGlvbiByYXRpb1Bob3RvKGJsb2NrKSB7XHJcbiAgICAkKGJsb2NrKS5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZhciBpdGVtV2lkdGggPSAkKHRoaXMpLndpZHRoKCk7XHJcbiAgICAgIHZhciBpdGVtSGVpZ2h0ID0gJCh0aGlzKS5oZWlnaHQoKTtcclxuICAgICAgdmFyIGl0ZW1SYXRpbyA9IGl0ZW1IZWlnaHQgLyBpdGVtV2lkdGg7XHJcblxyXG4gICAgICB2YXIgcGhvdG8gPSAkKHRoaXMpLmZpbmQoJ2ltZycpO1xyXG4gICAgICB2YXIgcGhvdG9XaWR0aCA9IHBob3RvLndpZHRoKCk7XHJcbiAgICAgIHZhciBwaG90b0hlaWdodCA9IHBob3RvLmhlaWdodCgpO1xyXG4gICAgICB2YXIgcGhvdG9SYXRpbyA9IHBob3RvSGVpZ2h0IC8gcGhvdG9XaWR0aDtcclxuXHJcbiAgICAgIGlmICggaXRlbVJhdGlvIDwgcGhvdG9SYXRpbyApIHtcclxuICAgICAgICBwaG90by53aWR0aCgnMTAwJScpO1xyXG4gICAgICAgIHBob3RvLmhlaWdodCgnYXV0bycpO1xyXG4gICAgICB9IGVsc2UgaWYgKGl0ZW1SYXRpbyA+IHBob3RvUmF0aW8pIHtcclxuICAgICAgICBwaG90by5oZWlnaHQoJzEwMCUnKTtcclxuICAgICAgICBwaG90by53aWR0aCgnYXV0bycpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBob3RvLndpZHRoKCcxMDAlJyk7XHJcbiAgICAgICAgcGhvdG8uaGVpZ2h0KCdhdXRvJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcmF0aW9MZXR0ZXIoYmxvY2spIHtcclxuICAgICQoYmxvY2spLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgdmFyIGl0ZW1XaWR0aCA9ICQodGhpcykud2lkdGgoKTtcclxuICAgICAgdmFyIGl0ZW1IZWlnaHQgPSAkKHRoaXMpLmhlaWdodCgpO1xyXG4gICAgICB2YXIgaXRlbVJhdGlvID0gaXRlbUhlaWdodCAvIGl0ZW1XaWR0aDtcclxuXHJcbiAgICAgIHZhciBwaG90byA9ICQodGhpcykuZmluZCgnaW1nJyk7XHJcbiAgICAgIHZhciBwaG90b1dpZHRoID0gcGhvdG8ud2lkdGgoKTtcclxuICAgICAgdmFyIHBob3RvSGVpZ2h0ID0gcGhvdG8uaGVpZ2h0KCk7XHJcbiAgICAgIHZhciBwaG90b1JhdGlvID0gcGhvdG9IZWlnaHQgLyBwaG90b1dpZHRoO1xyXG5cclxuICAgICAgaWYgKCBpdGVtUmF0aW8gPiBwaG90b1JhdGlvICkge1xyXG4gICAgICAgIHBob3RvLndpZHRoKCcxMDAlJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoaXRlbVJhdGlvIDwgcGhvdG9SYXRpbykge1xyXG4gICAgICAgIHBob3RvLmhlaWdodCgnMTAwJScpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBob3RvLndpZHRoKCcxMDAlJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmF0aW9QaG90bygnLnJldmlld19fc2xpZGVyLXByZXZpZXctaXRlbScpO1xyXG4gIHJhdGlvUGhvdG8oJy5yZXZpZXdfX3NsaWRlci1iaWctaXRlbScpO1xyXG4gIHJhdGlvTGV0dGVyKCcucmV2aWV3X19sZXR0ZXItYm94Jyk7XHJcbiAgcmF0aW9MZXR0ZXIoJy5yZXZpZXdfX2NoYXJ0LWJveCcpO1xyXG4gIHJhdGlvUGhvdG8oJy5nYWxsZXJ5X19pdGVtJyk7XHJcbiAgcmF0aW9QaG90bygnLnByb2plY3QtY2FyZF9fcGhvdG8nKTtcclxuICByYXRpb1Bob3RvKCcucmV2aWV3LWNhcmRfX3Zpc3VhbCcpO1xyXG4gIHJhdGlvUGhvdG8oJy5wcm9qZWN0X19waG90bycpO1xyXG5cclxuICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCl7XHJcbiAgICByYXRpb1Bob3RvKCcucmV2aWV3X19zbGlkZXItcHJldmlldy1pdGVtJyk7XHJcbiAgICByYXRpb1Bob3RvKCcucmV2aWV3X19zbGlkZXItYmlnLWl0ZW0nKTtcclxuICAgIHJhdGlvTGV0dGVyKCcucmV2aWV3X19sZXR0ZXItYm94Jyk7XHJcbiAgICByYXRpb0xldHRlcignLnJldmlld19fY2hhcnQtYm94Jyk7XHJcbiAgICByYXRpb1Bob3RvKCcuZ2FsbGVyeV9faXRlbScpO1xyXG4gICAgcmF0aW9QaG90bygnLnByb2plY3QtY2FyZF9fcGhvdG8nKTtcclxuICAgIHJhdGlvUGhvdG8oJy5yZXZpZXctY2FyZF9fdmlzdWFsJyk7XHJcbiAgICByYXRpb1Bob3RvKCcucHJvamVjdF9fcGhvdG8nKTtcclxuICB9KTtcclxuXHJcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG4gICQoJy5yZXZpZXdfX3NsaWRlci1iaWcnKS5zbGljayh7XHJcbiAgICBzbGlkZXNUb1Nob3c6IDEsXHJcbiAgICBzbGlkZXNUb1Njcm9sbDogMSxcclxuICAgIGFycm93czogZmFsc2UsXHJcbiAgICBmYWRlOiB0cnVlLFxyXG4gICAgYXNOYXZGb3I6ICcucmV2aWV3X19zbGlkZXItcHJldmlldydcclxuICB9KTtcclxuXHJcbiAgJCgnLnJldmlld19fc2xpZGVyLXByZXZpZXcnKS5zbGljayh7XHJcbiAgICBzbGlkZXNUb1Nob3c6IDQsXHJcbiAgICBzbGlkZXNUb1Njcm9sbDogMSxcclxuICAgIGFzTmF2Rm9yOiAnLnJldmlld19fc2xpZGVyLWJpZycsXHJcbiAgICBkb3RzOiBmYWxzZSxcclxuICAgIGNlbnRlck1vZGU6IGZhbHNlLFxyXG4gICAgZm9jdXNPblNlbGVjdDogdHJ1ZSxcclxuICAgIHJlc3BvbnNpdmU6IFtcclxuICAgICAge1xyXG4gICAgICAgIGJyZWFrcG9pbnQ6IDEyMDAsXHJcbiAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgIHNsaWRlc1RvU2hvdzogMlxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgXVxyXG4gIH0pO1xyXG5cclxufSk7IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuICAvLyDQn9C+0LvQt9GD0L3QvtC6INC00LvRjyDRhNC+0YDQvFxyXG4gIFxyXG4gIGZ1bmN0aW9uIHNsaWRlckZvcm0oIGlucHV0U3RhcnQsIGlucHV0RW5kLCBpZFNsaWRlciwgZGF0YVN0YXJ0LCBkYXRhRW5kICkge1xyXG4gICAgdmFyIHByaWNlU3RhcnQgPSAkKGlucHV0U3RhcnQpLmRhdGEoIGRhdGFTdGFydCApO1xyXG4gICAgdmFyIHByaWNlRW5kID0gJChpbnB1dEVuZCkuZGF0YSggZGF0YUVuZCApO1xyXG5cclxuICAgICQoIGlkU2xpZGVyICkuc2xpZGVyKHtcclxuICAgICAgLy8gb3JpZW50YXRpb246IFwidmVydGljYWxcIixcclxuICAgICAgLy8gc3RlcDogMTUsXHJcbiAgICAgIHJhbmdlOiB0cnVlLFxyXG4gICAgICBtaW46IHByaWNlU3RhcnQsXHJcbiAgICAgIG1heDogcHJpY2VFbmQsXHJcbiAgICAgIHZhbHVlczogWyBwcmljZVN0YXJ0LCBwcmljZUVuZCBdLFxyXG4gICAgICBzbGlkZTogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHtcclxuICAgICAgICAkKCBpbnB1dFN0YXJ0ICkudmFsKCB1aS52YWx1ZXNbIDAgXSApO1xyXG4gICAgICAgICQoIGlucHV0RW5kICkudmFsKCB1aS52YWx1ZXNbIDEgXSApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgICQoIGlucHV0U3RhcnQgKS52YWwoICQoIGlkU2xpZGVyICkuc2xpZGVyKCBcInZhbHVlc1wiLCAwICkgKTtcclxuICAgICQoIGlucHV0RW5kICkudmFsKCAkKCBpZFNsaWRlciApLnNsaWRlciggXCJ2YWx1ZXNcIiwgMSApICk7XHJcblxyXG4gICAgLy8g0JjQt9C80LXQvdC10L3QuNC1INC80LXRgdGC0L7Qv9C+0LvQvtC20LXQvdC40Y8g0L/QvtC70LfRg9C90LrQsCDQv9GA0Lgg0LLQstC+0LTQuNC00LUg0LTQsNC90L3Ri9GFINCyINC/0LXRgNCy0YvQuSDRjdC70LXQvNC10L3RgiBpbnB1dFxyXG4gICAgJCggaW5wdXRTdGFydCApLmNoYW5nZShmdW5jdGlvbigpe1xyXG4gICAgICB2YXIgdmFsdWUxPSQoIGlucHV0U3RhcnQgKS52YWwoKTtcclxuICAgICAgdmFyIHZhbHVlMj0kKCBpbnB1dEVuZCApLnZhbCgpO1xyXG5cclxuICAgICAgaWYgKHBhcnNlSW50KHZhbHVlMSkgPiBwYXJzZUludCh2YWx1ZTIpKXtcclxuICAgICAgICB2YWx1ZTEgPSB2YWx1ZTI7XHJcbiAgICAgICAgJCggaW5wdXRTdGFydCApLnZhbCh2YWx1ZTEpO1xyXG4gICAgICB9XHJcbiAgICAgICQoaWRTbGlkZXIpLnNsaWRlcihcInZhbHVlc1wiLDAsdmFsdWUxKTsgXHJcbiAgICB9KTtcclxuICAgICAgICBcclxuICAgIC8vINCY0LfQvNC10L3QtdC90LjQtSDQvNC10YHRgtC+0L/QvtC70L7QttC10L3QuNGPINC/0L7Qu9C30YPQvdC60LAg0L/RgNC4INCy0LLQvtC00LjQtNC1INC00LDQvdC90YvRhSDQsiDQstGC0L7RgNC+0Lkg0Y3Qu9C10LzQtdC90YIgaW5wdXQgIFxyXG4gICAgJCggaW5wdXRFbmQgKS5jaGFuZ2UoZnVuY3Rpb24oKXtcclxuICAgICAgdmFyIHZhbHVlMT0kKCBpbnB1dFN0YXJ0ICkudmFsKCk7XHJcbiAgICAgIHZhciB2YWx1ZTI9JCggaW5wdXRFbmQgKS52YWwoKTtcclxuXHJcbiAgICAgIGlmKHBhcnNlSW50KHZhbHVlMSkgPiBwYXJzZUludCh2YWx1ZTIpKXtcclxuICAgICAgICB2YWx1ZTIgPSB2YWx1ZTE7XHJcbiAgICAgICAgJCggaW5wdXRFbmQgKS52YWwodmFsdWUyKTtcclxuICAgICAgfVxyXG4gICAgICAkKGlkU2xpZGVyKS5zbGlkZXIoXCJ2YWx1ZXNcIiwxLHZhbHVlMik7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDRhNC40LvRjNGC0YDQsNGG0LjRjyDQstCy0L7QtNCwINCyINC/0L7Qu9GPXHJcbiAgICBqUXVlcnkoJyNhbW91bnRfc3RhcnQsICNhbW91bnRfZW5kJykua2V5cHJlc3MoZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgICB2YXIga2V5LCBrZXlDaGFyO1xyXG4gICAgICBpZighZXZlbnQpIHZhciBldmVudCA9IHdpbmRvdy5ldmVudDtcclxuICAgICAgXHJcbiAgICAgIGlmIChldmVudC5rZXlDb2RlKSBrZXkgPSBldmVudC5rZXlDb2RlO1xyXG4gICAgICBlbHNlIGlmKGV2ZW50LndoaWNoKSBrZXkgPSBldmVudC53aGljaDtcclxuICAgIFxyXG4gICAgICBpZihrZXk9PW51bGwgfHwga2V5PT0wIHx8IGtleT09OCB8fCBrZXk9PTEzIHx8IGtleT09OSB8fCBrZXk9PTQ2IHx8IGtleT09MzcgfHwga2V5PT0zOSApIHJldHVybiB0cnVlO1xyXG4gICAgICBrZXlDaGFyPVN0cmluZy5mcm9tQ2hhckNvZGUoa2V5KTtcclxuICAgICAgXHJcbiAgICAgIGlmKCEvXFxkLy50ZXN0KGtleUNoYXIpKSByZXR1cm4gZmFsc2U7XHJcbiAgICBcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIHNsaWRlckZvcm0oJy5wcm9qZWN0cy1maWx0ZXJfX2Nvc3QtLXN0YXJ0JywgJy5wcm9qZWN0cy1maWx0ZXJfX2Nvc3QtLWVuZCcsICcjcHJvamVjdC1zbGlkZXItdWknLCAncHJvai1zdGFydCcsICdwcm9qLWVuZCcpO1xyXG4gIHNsaWRlckZvcm0oJy5mb3JtX19jb3N0LS1zdGFydCcsICcuZm9ybV9fY29zdC0tZW5kJywgJyNmb3JtLXNsaWRlci11aScsICdwcmljZS1zdGFydCcsICdwcmljZS1lbmQnKTtcclxuXHJcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG4gIGZ1bmN0aW9uIHRlbE1hc2soc2VsZWN0b3IpIHtcclxuICAgICQoc2VsZWN0b3IpLm1hc2soJys3ICgwMDApIDAwMC0wMC0wMCcpO1xyXG4gIH1cclxuXHJcbiAgdGVsTWFzaygnLmNvbnRhY3QtZm9ybV9faW5wdXQtLXRlbCcpO1xyXG4gIHRlbE1hc2soJy5jb25zdWx0X19pbnB1dC10ZWwnKTtcclxuXHJcbn0pOyJdfQ==
