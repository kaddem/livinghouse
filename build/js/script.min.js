$(document).ready(function(){

  // бургер, что тут еще скажешь? но без колы(
  $('.burger').on('click', function(e){
      e.preventDefault();
      if ( $(this).hasClass("burger--close") ) {
          $(this).removeClass('burger--close');
          $('.main-nav').slideUp(400);
          $('.main-nav').removeClass('main-nav--open');
          $('.page-header').removeClass('page-header--open');
      } else {
          $(this).addClass('burger--close');
          $('.main-nav').slideDown(400);
          $('.main-nav').addClass('main-nav--open');
          $('.page-header').addClass('page-header--open');
      }
  });

  $('.nav ul a').on('click', function(e){
      if ($(window).width() < 768) {
          $('.main-nav').slideUp(400);
          $('.burger').addClass('burger--open');
          $('.burger').removeClass('burger--close');
      };
  });


  $(window).resize(function(){
      if( $(window).width() > 767 ) {
          $('.main-nav').show();
      } else {
          $('.main-nav').slideUp(400);
          $('.main-nav').removeClass('main-nav--open');
          $('.page-header').removeClass('page-header--open');
          $('.burger').removeClass('burger--close');
      }
  });

  $(window).on('scroll', function(e) { // отслеживаем событие на элементе window
    if( $(window).width() < 768 ) {
        $('.main-nav').slideUp(400);
        $('.main-nav').removeClass('main-nav--open');
        $('.page-header').removeClass('page-header--open');
        $('.burger').removeClass('burger--close');
    }
  });

  if ( $(window).scrollTop() > 100 && $(window).width() > 767) {
    $('.page-header').addClass('page-header--scroll');
    $('.page-header').addClass('page-header--desktop');
  } else if ( $(window).scrollTop() > 100 ) {
    $('.page-header').addClass('page-header--scroll');
  }

  $(window).on('scroll', function(e) {

    if ( $(window).scrollTop() > 100 && $(window).width() > 1199 ) {
      $('.page-header').addClass('page-header--scroll');
      $('.page-header').addClass('page-header--desktop');
    } else if ( $(window).scrollTop() > 100 ) {
      $('.page-header').addClass('page-header--scroll');
      $('.page-header').removeClass('page-header--desktop');
    } else {
      $('.page-header').removeClass('page-header--scroll');
      $('.page-header').removeClass('page-header--desktop');
    }

  });

});
$(document).ready(function(){

  $(function(){

    var dateEnd = $('#countdown-promo').data('timer-hours');
  
    var note = $('#note'),
      ts = new Date(2012, 0, 1),
      newYear = true;
    
    if((new Date()) > ts){
      // The new year is here! Count towards something else.
      // Notice the *1000 at the end - time must be in milliseconds
      ts = (new Date()).getTime() + dateEnd*24*60*60*1000;
      newYear = false;
    }


      
    $('#countdown-promo').countdown({
      timestamp : ts,
      callback  : function(days, hours, minutes, seconds){
        
        var message = "";
        
        message += days + " day" + ( days==1 ? '':'s' ) + ", ";
        message += hours + " hour" + ( hours==1 ? '':'s' ) + ", ";
        message += minutes + " minute" + ( minutes==1 ? '':'s' ) + " and ";
        message += seconds + " second" + ( seconds==1 ? '':'s' ) + " <br />";
        
        if(newYear){
          message += "left until the new year!";
        }
        else {
          message += "left to 10 days from now!";
        }
        
        note.html(message);
      }
    });
    
  });

});
$(document).ready(function(){

  // Закрытие дропдаунов по клику вне их

  function closeOutDropdown(dropDown, input) {

    $(document).mouseup(function (e){ // событие клика по веб-документу
      var drop = $(dropDown); // тут указываем ID элемента
      var inp = $(input);
      if (inp.is(e.target)) {
        return;
      } else if (!drop.is(e.target) // если клик был не по нашему блоку
          && drop.has(e.target).length === 0) { // и не по его дочерним элементам
        drop.hide(); // скрываем его
      } 
    });

  }

  closeOutDropdown('.form__dropdown', '.form__selected');
  closeOutDropdown('.projects-filter__dropdown', '.projects-filter__selected');
  closeOutDropdown('.form-review__dropdown', '.form-review__selected');

  function clickSelect(select, dropList){

    $(select).on('click', function(e){
    
      var dropDown = $(this).find(dropList);
      var everDropDown = $(dropList);
      
      if ( dropDown.is(':visible') ) {
        everDropDown.hide();
      } else if ( dropDown.is(':hidden') ) {
        everDropDown.hide();
        dropDown.show();
      } 
      
    });

  }

  clickSelect('.form__select', '.form__dropdown');
  clickSelect('.projects-filter__select', '.projects-filter__dropdown');
  clickSelect('.form-review__select', '.form-review__dropdown');

});
$(document).ready(function(){
  
  function closeOutDropdown(dropDown, input) {

      $(document).mouseup(function (e){ // событие клика по веб-документу
        
        if ( $('.project-form__value-list').hasClass('project-form__value-list--active')) {
          var drop = $(dropDown); // тут указываем ID элемента
          var inp = $(input);
          if (inp.is(e.target)) {
            return;
          } else if (!drop.is(e.target) // если клик был не по нашему блоку
              && drop.has(e.target).length === 0) { // и не по его дочерним элементам
            drop.removeClass('project-form__value-list--active'); // скрываем его
          } 
        }

      });

  }
  
  closeOutDropdown('.project-form__value-list', '.project-form__value-label');
  
  
  $('.project-form__value-label').on('click', function(){
    
    var inputId = $( this ).attr('for');
    var inputThis = $ ('#' + inputId );
    var parent = $( this ).parent();
    
    if ( inputThis.prop("checked") ) {
      $('.project-form__value-list').removeClass('project-form__value-list--active');
      $( parent ).addClass('project-form__value-list--active');
    } else {
      $( parent ).removeClass('project-form__value-list--active');
    }
    
  });
  
});
$(document).ready(function(){

  $('.project-form__title--accordeon').on('click', function(){

    var showBlock = $('#dropdown-table');

    if ( (showBlock ).hasClass('project-form__table--hide') ) {
      $( this ).addClass('project-form__title--open');
      $(showBlock).slideDown(200);
      $(showBlock).removeClass('project-form__table--hide');
    } else {
      $( this ).removeClass('project-form__title--open');
      $(showBlock).slideUp(200);
      $(showBlock).addClass('project-form__table--hide');
    }

  });

});
$(document).ready(function(){

  function tabs(boxTabsLink, boxTabsContent, tabs){ 
    $(boxTabsLink + ' input').on('click', function(e){
      var attrLink = $(this).attr('id');
      $(boxTabsContent + ' ' + tabs).css("display", "none");
      $(boxTabsContent + ' .' + attrLink).css("display", "block");
    }); 
  };


  tabs('#tabs-roof', '#tabs-roof-content', '.project-form__table-select--roof-content');
  tabs('#tabs-frame', '#tabs-frame-content', '.project-form__tab-item');

});
$(document).ready(function(){

  $('.promo-slider').slick({
    dots: true
    // autoplay: true,
    // autoplaySpeed: 500
  });

});
$(document).ready(function(){

  function abc2(n) {
    n += "";
    n = new Array(4 - n.length % 3).join("U") + n;
    return n.replace(/([0-9U]{3})/g, "$1 ").replace(/U/g, "");
  }

  $('.project-form__plus-minus').on('click', function(){
    var thisElem = $(this);
    var input = $('.project-form__input-quant');
    var value = Number( input.val() );
    var price = $('#pile-price').data( 'one-price' );

    if ( value == 0 && $(thisElem).hasClass( 'project-form__plus-minus--plus' ) ) {
      value = value + 1;
      $(input).val(value);
    } else if ( value == 0 ){
      return;
    } else if ( $(thisElem).hasClass( 'project-form__plus-minus--plus' ) ){
      value = value + 1;
      $(input).val(value);
    } else {
      value = value - 1;
      $(input).val(value);
    }

    var priceSumm = abc2(price * value);

    $('#price-summ').text(priceSumm);

  })


  $('.project-form__action-label').on('click', function(){

    var parent = $(this).parent();
    var check = $(parent).find('.project-form__action-check');

    if ( $(check).prop("checked") ) {
      $(this).text('Добавить');
    } else {
      $(this).text('Добавлено');
    }

  });

});
$(window).load(function() {

  function ratioPhoto(block) {
    $(block).each(function(){
      var itemWidth = $(this).width();
      var itemHeight = $(this).height();
      var itemRatio = itemHeight / itemWidth;

      var photo = $(this).find('img');
      var photoWidth = photo.width();
      var photoHeight = photo.height();
      var photoRatio = photoHeight / photoWidth;

      if ( itemRatio < photoRatio ) {
        photo.width('100%');
        photo.height('auto');
      } else if (itemRatio > photoRatio) {
        photo.height('100%');
        photo.width('auto');
      } else {
        photo.width('100%');
        photo.height('auto');
      }
    });
  }

  function ratioLetter(block) {
    $(block).each(function(){
      var itemWidth = $(this).width();
      var itemHeight = $(this).height();
      var itemRatio = itemHeight / itemWidth;

      var photo = $(this).find('img');
      var photoWidth = photo.width();
      var photoHeight = photo.height();
      var photoRatio = photoHeight / photoWidth;

      if ( itemRatio > photoRatio ) {
        photo.width('100%');
      } else if (itemRatio < photoRatio) {
        photo.height('100%');
      } else {
        photo.width('100%');
      }
    });
  }

  ratioPhoto('.review__slider-preview-item');
  ratioPhoto('.review__slider-big-item');
  ratioLetter('.review__letter-box');
  ratioLetter('.review__chart-box');
  ratioPhoto('.gallery__item');
  ratioPhoto('.project-card__photo');
  ratioPhoto('.review-card__visual');
  ratioPhoto('.project__photo');

  $(window).resize(function(){
    ratioPhoto('.review__slider-preview-item');
    ratioPhoto('.review__slider-big-item');
    ratioLetter('.review__letter-box');
    ratioLetter('.review__chart-box');
    ratioPhoto('.gallery__item');
    ratioPhoto('.project-card__photo');
    ratioPhoto('.review-card__visual');
    ratioPhoto('.project__photo');
  });

});
$(document).ready(function(){

  $('.review__slider-big').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    arrows: false,
    fade: true,
    asNavFor: '.review__slider-preview'
  });

  $('.review__slider-preview').slick({
    slidesToShow: 4,
    slidesToScroll: 1,
    asNavFor: '.review__slider-big',
    dots: false,
    centerMode: false,
    focusOnSelect: true,
    responsive: [
      {
        breakpoint: 1200,
        settings: {
          slidesToShow: 2
        }
      }
    ]
  });

});
$(document).ready(function(){
  // Ползунок для форм
  
  function sliderForm( inputStart, inputEnd, idSlider, dataStart, dataEnd ) {
    var priceStart = $(inputStart).data( dataStart );
    var priceEnd = $(inputEnd).data( dataEnd );

    $( idSlider ).slider({
      // orientation: "vertical",
      // step: 15,
      range: true,
      min: priceStart,
      max: priceEnd,
      values: [ priceStart, priceEnd ],
      slide: function( event, ui ) {
        $( inputStart ).val( ui.values[ 0 ] );
        $( inputEnd ).val( ui.values[ 1 ] );
      }
    });
    $( inputStart ).val( $( idSlider ).slider( "values", 0 ) );
    $( inputEnd ).val( $( idSlider ).slider( "values", 1 ) );

    // Изменение местоположения ползунка при вводиде данных в первый элемент input
    $( inputStart ).change(function(){
      var value1=$( inputStart ).val();
      var value2=$( inputEnd ).val();

      if (parseInt(value1) > parseInt(value2)){
        value1 = value2;
        $( inputStart ).val(value1);
      }
      $(idSlider).slider("values",0,value1); 
    });
        
    // Изменение местоположения ползунка при вводиде данных в второй элемент input  
    $( inputEnd ).change(function(){
      var value1=$( inputStart ).val();
      var value2=$( inputEnd ).val();

      if(parseInt(value1) > parseInt(value2)){
        value2 = value1;
        $( inputEnd ).val(value2);
      }
      $(idSlider).slider("values",1,value2);
    });

    // фильтрация ввода в поля
    jQuery('#amount_start, #amount_end').keypress(function(event){
      var key, keyChar;
      if(!event) var event = window.event;
      
      if (event.keyCode) key = event.keyCode;
      else if(event.which) key = event.which;
    
      if(key==null || key==0 || key==8 || key==13 || key==9 || key==46 || key==37 || key==39 ) return true;
      keyChar=String.fromCharCode(key);
      
      if(!/\d/.test(keyChar)) return false;
    
    });

  }

  sliderForm('.projects-filter__cost--start', '.projects-filter__cost--end', '#project-slider-ui', 'proj-start', 'proj-end');
  sliderForm('.form__cost--start', '.form__cost--end', '#form-slider-ui', 'price-start', 'price-end');

});
$(document).ready(function(){

  function telMask(selector) {
    $(selector).mask('+7 (000) 000-00-00');
  }

  telMask('.contact-form__input--tel');
  telMask('.consult__input-tel');

});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1cmdlci5qcyIsImNvdW50ZG93bi5qcyIsImRyb3Bkb3duLWZpbHRlci5qcyIsImRyb3Bkb3duLXByb2plY3QuanMiLCJwaWxzLWRyb3Bkb3duLmpzIiwicHJvamVjdC10YWJzLmpzIiwicHJvbW8tc2xpZGVyLmpzIiwicXVhbnRpdHktcHJvamVjdC5qcyIsInJhdGlvLXBob3RvLmpzIiwicmV2aWV3LXNsaWRlci5qcyIsInNsaWRlci1mb3JtLmpzIiwidGVsLW1hc2suanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuXHJcbiAgLy8g0LHRg9GA0LPQtdGALCDRh9GC0L4g0YLRg9GCINC10YnQtSDRgdC60LDQttC10YjRjD8g0L3QviDQsdC10Lcg0LrQvtC70YsoXHJcbiAgJCgnLmJ1cmdlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGlmICggJCh0aGlzKS5oYXNDbGFzcyhcImJ1cmdlci0tY2xvc2VcIikgKSB7XHJcbiAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdidXJnZXItLWNsb3NlJyk7XHJcbiAgICAgICAgICAkKCcubWFpbi1uYXYnKS5zbGlkZVVwKDQwMCk7XHJcbiAgICAgICAgICAkKCcubWFpbi1uYXYnKS5yZW1vdmVDbGFzcygnbWFpbi1uYXYtLW9wZW4nKTtcclxuICAgICAgICAgICQoJy5wYWdlLWhlYWRlcicpLnJlbW92ZUNsYXNzKCdwYWdlLWhlYWRlci0tb3BlbicpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnYnVyZ2VyLS1jbG9zZScpO1xyXG4gICAgICAgICAgJCgnLm1haW4tbmF2Jykuc2xpZGVEb3duKDQwMCk7XHJcbiAgICAgICAgICAkKCcubWFpbi1uYXYnKS5hZGRDbGFzcygnbWFpbi1uYXYtLW9wZW4nKTtcclxuICAgICAgICAgICQoJy5wYWdlLWhlYWRlcicpLmFkZENsYXNzKCdwYWdlLWhlYWRlci0tb3BlbicpO1xyXG4gICAgICB9XHJcbiAgfSk7XHJcblxyXG4gICQoJy5uYXYgdWwgYScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPCA3NjgpIHtcclxuICAgICAgICAgICQoJy5tYWluLW5hdicpLnNsaWRlVXAoNDAwKTtcclxuICAgICAgICAgICQoJy5idXJnZXInKS5hZGRDbGFzcygnYnVyZ2VyLS1vcGVuJyk7XHJcbiAgICAgICAgICAkKCcuYnVyZ2VyJykucmVtb3ZlQ2xhc3MoJ2J1cmdlci0tY2xvc2UnKTtcclxuICAgICAgfTtcclxuICB9KTtcclxuXHJcblxyXG4gICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKXtcclxuICAgICAgaWYoICQod2luZG93KS53aWR0aCgpID4gNzY3ICkge1xyXG4gICAgICAgICAgJCgnLm1haW4tbmF2Jykuc2hvdygpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgJCgnLm1haW4tbmF2Jykuc2xpZGVVcCg0MDApO1xyXG4gICAgICAgICAgJCgnLm1haW4tbmF2JykucmVtb3ZlQ2xhc3MoJ21haW4tbmF2LS1vcGVuJyk7XHJcbiAgICAgICAgICAkKCcucGFnZS1oZWFkZXInKS5yZW1vdmVDbGFzcygncGFnZS1oZWFkZXItLW9wZW4nKTtcclxuICAgICAgICAgICQoJy5idXJnZXInKS5yZW1vdmVDbGFzcygnYnVyZ2VyLS1jbG9zZScpO1xyXG4gICAgICB9XHJcbiAgfSk7XHJcblxyXG4gICQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oZSkgeyAvLyDQvtGC0YHQu9C10LbQuNCy0LDQtdC8INGB0L7QsdGL0YLQuNC1INC90LAg0Y3Qu9C10LzQtdC90YLQtSB3aW5kb3dcclxuICAgIGlmKCAkKHdpbmRvdykud2lkdGgoKSA8IDc2OCApIHtcclxuICAgICAgICAkKCcubWFpbi1uYXYnKS5zbGlkZVVwKDQwMCk7XHJcbiAgICAgICAgJCgnLm1haW4tbmF2JykucmVtb3ZlQ2xhc3MoJ21haW4tbmF2LS1vcGVuJyk7XHJcbiAgICAgICAgJCgnLnBhZ2UtaGVhZGVyJykucmVtb3ZlQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1vcGVuJyk7XHJcbiAgICAgICAgJCgnLmJ1cmdlcicpLnJlbW92ZUNsYXNzKCdidXJnZXItLWNsb3NlJyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGlmICggJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gMTAwICYmICQod2luZG93KS53aWR0aCgpID4gNzY3KSB7XHJcbiAgICAkKCcucGFnZS1oZWFkZXInKS5hZGRDbGFzcygncGFnZS1oZWFkZXItLXNjcm9sbCcpO1xyXG4gICAgJCgnLnBhZ2UtaGVhZGVyJykuYWRkQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1kZXNrdG9wJyk7XHJcbiAgfSBlbHNlIGlmICggJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gMTAwICkge1xyXG4gICAgJCgnLnBhZ2UtaGVhZGVyJykuYWRkQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1zY3JvbGwnKTtcclxuICB9XHJcblxyXG4gICQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oZSkge1xyXG5cclxuICAgIGlmICggJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gMTAwICYmICQod2luZG93KS53aWR0aCgpID4gMTE5OSApIHtcclxuICAgICAgJCgnLnBhZ2UtaGVhZGVyJykuYWRkQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1zY3JvbGwnKTtcclxuICAgICAgJCgnLnBhZ2UtaGVhZGVyJykuYWRkQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1kZXNrdG9wJyk7XHJcbiAgICB9IGVsc2UgaWYgKCAkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiAxMDAgKSB7XHJcbiAgICAgICQoJy5wYWdlLWhlYWRlcicpLmFkZENsYXNzKCdwYWdlLWhlYWRlci0tc2Nyb2xsJyk7XHJcbiAgICAgICQoJy5wYWdlLWhlYWRlcicpLnJlbW92ZUNsYXNzKCdwYWdlLWhlYWRlci0tZGVza3RvcCcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgJCgnLnBhZ2UtaGVhZGVyJykucmVtb3ZlQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1zY3JvbGwnKTtcclxuICAgICAgJCgnLnBhZ2UtaGVhZGVyJykucmVtb3ZlQ2xhc3MoJ3BhZ2UtaGVhZGVyLS1kZXNrdG9wJyk7XHJcbiAgICB9XHJcblxyXG4gIH0pO1xyXG5cclxufSk7IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuXHJcbiAgJChmdW5jdGlvbigpe1xyXG5cclxuICAgIHZhciBkYXRlRW5kID0gJCgnI2NvdW50ZG93bi1wcm9tbycpLmRhdGEoJ3RpbWVyLWhvdXJzJyk7XHJcbiAgXHJcbiAgICB2YXIgbm90ZSA9ICQoJyNub3RlJyksXHJcbiAgICAgIHRzID0gbmV3IERhdGUoMjAxMiwgMCwgMSksXHJcbiAgICAgIG5ld1llYXIgPSB0cnVlO1xyXG4gICAgXHJcbiAgICBpZigobmV3IERhdGUoKSkgPiB0cyl7XHJcbiAgICAgIC8vIFRoZSBuZXcgeWVhciBpcyBoZXJlISBDb3VudCB0b3dhcmRzIHNvbWV0aGluZyBlbHNlLlxyXG4gICAgICAvLyBOb3RpY2UgdGhlICoxMDAwIGF0IHRoZSBlbmQgLSB0aW1lIG11c3QgYmUgaW4gbWlsbGlzZWNvbmRzXHJcbiAgICAgIHRzID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIGRhdGVFbmQqMjQqNjAqNjAqMTAwMDtcclxuICAgICAgbmV3WWVhciA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAgIFxyXG4gICAgJCgnI2NvdW50ZG93bi1wcm9tbycpLmNvdW50ZG93bih7XHJcbiAgICAgIHRpbWVzdGFtcCA6IHRzLFxyXG4gICAgICBjYWxsYmFjayAgOiBmdW5jdGlvbihkYXlzLCBob3VycywgbWludXRlcywgc2Vjb25kcyl7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIlwiO1xyXG4gICAgICAgIFxyXG4gICAgICAgIG1lc3NhZ2UgKz0gZGF5cyArIFwiIGRheVwiICsgKCBkYXlzPT0xID8gJyc6J3MnICkgKyBcIiwgXCI7XHJcbiAgICAgICAgbWVzc2FnZSArPSBob3VycyArIFwiIGhvdXJcIiArICggaG91cnM9PTEgPyAnJzoncycgKSArIFwiLCBcIjtcclxuICAgICAgICBtZXNzYWdlICs9IG1pbnV0ZXMgKyBcIiBtaW51dGVcIiArICggbWludXRlcz09MSA/ICcnOidzJyApICsgXCIgYW5kIFwiO1xyXG4gICAgICAgIG1lc3NhZ2UgKz0gc2Vjb25kcyArIFwiIHNlY29uZFwiICsgKCBzZWNvbmRzPT0xID8gJyc6J3MnICkgKyBcIiA8YnIgLz5cIjtcclxuICAgICAgICBcclxuICAgICAgICBpZihuZXdZZWFyKXtcclxuICAgICAgICAgIG1lc3NhZ2UgKz0gXCJsZWZ0IHVudGlsIHRoZSBuZXcgeWVhciFcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBtZXNzYWdlICs9IFwibGVmdCB0byAxMCBkYXlzIGZyb20gbm93IVwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBub3RlLmh0bWwobWVzc2FnZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgfSk7XHJcblxyXG59KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xyXG5cclxuICAvLyDQl9Cw0LrRgNGL0YLQuNC1INC00YDQvtC/0LTQsNGD0L3QvtCyINC/0L4g0LrQu9C40LrRgyDQstC90LUg0LjRhVxyXG5cclxuICBmdW5jdGlvbiBjbG9zZU91dERyb3Bkb3duKGRyb3BEb3duLCBpbnB1dCkge1xyXG5cclxuICAgICQoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24gKGUpeyAvLyDRgdC+0LHRi9GC0LjQtSDQutC70LjQutCwINC/0L4g0LLQtdCxLdC00L7QutGD0LzQtdC90YLRg1xyXG4gICAgICB2YXIgZHJvcCA9ICQoZHJvcERvd24pOyAvLyDRgtGD0YIg0YPQutCw0LfRi9Cy0LDQtdC8IElEINGN0LvQtdC80LXQvdGC0LBcclxuICAgICAgdmFyIGlucCA9ICQoaW5wdXQpO1xyXG4gICAgICBpZiAoaW5wLmlzKGUudGFyZ2V0KSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSBlbHNlIGlmICghZHJvcC5pcyhlLnRhcmdldCkgLy8g0LXRgdC70Lgg0LrQu9C40Log0LHRi9C7INC90LUg0L/QviDQvdCw0YjQtdC80YMg0LHQu9C+0LrRg1xyXG4gICAgICAgICAgJiYgZHJvcC5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMCkgeyAvLyDQuCDQvdC1INC/0L4g0LXQs9C+INC00L7Rh9C10YDQvdC40Lwg0Y3Qu9C10LzQtdC90YLQsNC8XHJcbiAgICAgICAgZHJvcC5oaWRlKCk7IC8vINGB0LrRgNGL0LLQsNC10Lwg0LXQs9C+XHJcbiAgICAgIH0gXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBjbG9zZU91dERyb3Bkb3duKCcuZm9ybV9fZHJvcGRvd24nLCAnLmZvcm1fX3NlbGVjdGVkJyk7XHJcbiAgY2xvc2VPdXREcm9wZG93bignLnByb2plY3RzLWZpbHRlcl9fZHJvcGRvd24nLCAnLnByb2plY3RzLWZpbHRlcl9fc2VsZWN0ZWQnKTtcclxuICBjbG9zZU91dERyb3Bkb3duKCcuZm9ybS1yZXZpZXdfX2Ryb3Bkb3duJywgJy5mb3JtLXJldmlld19fc2VsZWN0ZWQnKTtcclxuXHJcbiAgZnVuY3Rpb24gY2xpY2tTZWxlY3Qoc2VsZWN0LCBkcm9wTGlzdCl7XHJcblxyXG4gICAgJChzZWxlY3QpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgXHJcbiAgICAgIHZhciBkcm9wRG93biA9ICQodGhpcykuZmluZChkcm9wTGlzdCk7XHJcbiAgICAgIHZhciBldmVyRHJvcERvd24gPSAkKGRyb3BMaXN0KTtcclxuICAgICAgXHJcbiAgICAgIGlmICggZHJvcERvd24uaXMoJzp2aXNpYmxlJykgKSB7XHJcbiAgICAgICAgZXZlckRyb3BEb3duLmhpZGUoKTtcclxuICAgICAgfSBlbHNlIGlmICggZHJvcERvd24uaXMoJzpoaWRkZW4nKSApIHtcclxuICAgICAgICBldmVyRHJvcERvd24uaGlkZSgpO1xyXG4gICAgICAgIGRyb3BEb3duLnNob3coKTtcclxuICAgICAgfSBcclxuICAgICAgXHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBjbGlja1NlbGVjdCgnLmZvcm1fX3NlbGVjdCcsICcuZm9ybV9fZHJvcGRvd24nKTtcclxuICBjbGlja1NlbGVjdCgnLnByb2plY3RzLWZpbHRlcl9fc2VsZWN0JywgJy5wcm9qZWN0cy1maWx0ZXJfX2Ryb3Bkb3duJyk7XHJcbiAgY2xpY2tTZWxlY3QoJy5mb3JtLXJldmlld19fc2VsZWN0JywgJy5mb3JtLXJldmlld19fZHJvcGRvd24nKTtcclxuXHJcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcbiAgXHJcbiAgZnVuY3Rpb24gY2xvc2VPdXREcm9wZG93bihkcm9wRG93biwgaW5wdXQpIHtcclxuXHJcbiAgICAgICQoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24gKGUpeyAvLyDRgdC+0LHRi9GC0LjQtSDQutC70LjQutCwINC/0L4g0LLQtdCxLdC00L7QutGD0LzQtdC90YLRg1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICggJCgnLnByb2plY3QtZm9ybV9fdmFsdWUtbGlzdCcpLmhhc0NsYXNzKCdwcm9qZWN0LWZvcm1fX3ZhbHVlLWxpc3QtLWFjdGl2ZScpKSB7XHJcbiAgICAgICAgICB2YXIgZHJvcCA9ICQoZHJvcERvd24pOyAvLyDRgtGD0YIg0YPQutCw0LfRi9Cy0LDQtdC8IElEINGN0LvQtdC80LXQvdGC0LBcclxuICAgICAgICAgIHZhciBpbnAgPSAkKGlucHV0KTtcclxuICAgICAgICAgIGlmIChpbnAuaXMoZS50YXJnZXQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoIWRyb3AuaXMoZS50YXJnZXQpIC8vINC10YHQu9C4INC60LvQuNC6INCx0YvQuyDQvdC1INC/0L4g0L3QsNGI0LXQvNGDINCx0LvQvtC60YNcclxuICAgICAgICAgICAgICAmJiBkcm9wLmhhcyhlLnRhcmdldCkubGVuZ3RoID09PSAwKSB7IC8vINC4INC90LUg0L/QviDQtdCz0L4g0LTQvtGH0LXRgNC90LjQvCDRjdC70LXQvNC10L3RgtCw0LxcclxuICAgICAgICAgICAgZHJvcC5yZW1vdmVDbGFzcygncHJvamVjdC1mb3JtX192YWx1ZS1saXN0LS1hY3RpdmUnKTsgLy8g0YHQutGA0YvQstCw0LXQvCDQtdCz0L5cclxuICAgICAgICAgIH0gXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSk7XHJcblxyXG4gIH1cclxuICBcclxuICBjbG9zZU91dERyb3Bkb3duKCcucHJvamVjdC1mb3JtX192YWx1ZS1saXN0JywgJy5wcm9qZWN0LWZvcm1fX3ZhbHVlLWxhYmVsJyk7XHJcbiAgXHJcbiAgXHJcbiAgJCgnLnByb2plY3QtZm9ybV9fdmFsdWUtbGFiZWwnKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xyXG4gICAgXHJcbiAgICB2YXIgaW5wdXRJZCA9ICQoIHRoaXMgKS5hdHRyKCdmb3InKTtcclxuICAgIHZhciBpbnB1dFRoaXMgPSAkICgnIycgKyBpbnB1dElkICk7XHJcbiAgICB2YXIgcGFyZW50ID0gJCggdGhpcyApLnBhcmVudCgpO1xyXG4gICAgXHJcbiAgICBpZiAoIGlucHV0VGhpcy5wcm9wKFwiY2hlY2tlZFwiKSApIHtcclxuICAgICAgJCgnLnByb2plY3QtZm9ybV9fdmFsdWUtbGlzdCcpLnJlbW92ZUNsYXNzKCdwcm9qZWN0LWZvcm1fX3ZhbHVlLWxpc3QtLWFjdGl2ZScpO1xyXG4gICAgICAkKCBwYXJlbnQgKS5hZGRDbGFzcygncHJvamVjdC1mb3JtX192YWx1ZS1saXN0LS1hY3RpdmUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICQoIHBhcmVudCApLnJlbW92ZUNsYXNzKCdwcm9qZWN0LWZvcm1fX3ZhbHVlLWxpc3QtLWFjdGl2ZScpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgfSk7XHJcbiAgXHJcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG4gICQoJy5wcm9qZWN0LWZvcm1fX3RpdGxlLS1hY2NvcmRlb24nKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xyXG5cclxuICAgIHZhciBzaG93QmxvY2sgPSAkKCcjZHJvcGRvd24tdGFibGUnKTtcclxuXHJcbiAgICBpZiAoIChzaG93QmxvY2sgKS5oYXNDbGFzcygncHJvamVjdC1mb3JtX190YWJsZS0taGlkZScpICkge1xyXG4gICAgICAkKCB0aGlzICkuYWRkQ2xhc3MoJ3Byb2plY3QtZm9ybV9fdGl0bGUtLW9wZW4nKTtcclxuICAgICAgJChzaG93QmxvY2spLnNsaWRlRG93bigyMDApO1xyXG4gICAgICAkKHNob3dCbG9jaykucmVtb3ZlQ2xhc3MoJ3Byb2plY3QtZm9ybV9fdGFibGUtLWhpZGUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICQoIHRoaXMgKS5yZW1vdmVDbGFzcygncHJvamVjdC1mb3JtX190aXRsZS0tb3BlbicpO1xyXG4gICAgICAkKHNob3dCbG9jaykuc2xpZGVVcCgyMDApO1xyXG4gICAgICAkKHNob3dCbG9jaykuYWRkQ2xhc3MoJ3Byb2plY3QtZm9ybV9fdGFibGUtLWhpZGUnKTtcclxuICAgIH1cclxuXHJcbiAgfSk7XHJcblxyXG59KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xyXG5cclxuICBmdW5jdGlvbiB0YWJzKGJveFRhYnNMaW5rLCBib3hUYWJzQ29udGVudCwgdGFicyl7IFxyXG4gICAgJChib3hUYWJzTGluayArICcgaW5wdXQnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgdmFyIGF0dHJMaW5rID0gJCh0aGlzKS5hdHRyKCdpZCcpO1xyXG4gICAgICAkKGJveFRhYnNDb250ZW50ICsgJyAnICsgdGFicykuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICQoYm94VGFic0NvbnRlbnQgKyAnIC4nICsgYXR0ckxpbmspLmNzcyhcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcclxuICAgIH0pOyBcclxuICB9O1xyXG5cclxuXHJcbiAgdGFicygnI3RhYnMtcm9vZicsICcjdGFicy1yb29mLWNvbnRlbnQnLCAnLnByb2plY3QtZm9ybV9fdGFibGUtc2VsZWN0LS1yb29mLWNvbnRlbnQnKTtcclxuICB0YWJzKCcjdGFicy1mcmFtZScsICcjdGFicy1mcmFtZS1jb250ZW50JywgJy5wcm9qZWN0LWZvcm1fX3RhYi1pdGVtJyk7XHJcblxyXG59KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xyXG5cclxuICAkKCcucHJvbW8tc2xpZGVyJykuc2xpY2soe1xyXG4gICAgZG90czogdHJ1ZVxyXG4gICAgLy8gYXV0b3BsYXk6IHRydWUsXHJcbiAgICAvLyBhdXRvcGxheVNwZWVkOiA1MDBcclxuICB9KTtcclxuXHJcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcblxyXG4gIGZ1bmN0aW9uIGFiYzIobikge1xyXG4gICAgbiArPSBcIlwiO1xyXG4gICAgbiA9IG5ldyBBcnJheSg0IC0gbi5sZW5ndGggJSAzKS5qb2luKFwiVVwiKSArIG47XHJcbiAgICByZXR1cm4gbi5yZXBsYWNlKC8oWzAtOVVdezN9KS9nLCBcIiQxIFwiKS5yZXBsYWNlKC9VL2csIFwiXCIpO1xyXG4gIH1cclxuXHJcbiAgJCgnLnByb2plY3QtZm9ybV9fcGx1cy1taW51cycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgdGhpc0VsZW0gPSAkKHRoaXMpO1xyXG4gICAgdmFyIGlucHV0ID0gJCgnLnByb2plY3QtZm9ybV9faW5wdXQtcXVhbnQnKTtcclxuICAgIHZhciB2YWx1ZSA9IE51bWJlciggaW5wdXQudmFsKCkgKTtcclxuICAgIHZhciBwcmljZSA9ICQoJyNwaWxlLXByaWNlJykuZGF0YSggJ29uZS1wcmljZScgKTtcclxuXHJcbiAgICBpZiAoIHZhbHVlID09IDAgJiYgJCh0aGlzRWxlbSkuaGFzQ2xhc3MoICdwcm9qZWN0LWZvcm1fX3BsdXMtbWludXMtLXBsdXMnICkgKSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUgKyAxO1xyXG4gICAgICAkKGlucHV0KS52YWwodmFsdWUpO1xyXG4gICAgfSBlbHNlIGlmICggdmFsdWUgPT0gMCApe1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9IGVsc2UgaWYgKCAkKHRoaXNFbGVtKS5oYXNDbGFzcyggJ3Byb2plY3QtZm9ybV9fcGx1cy1taW51cy0tcGx1cycgKSApe1xyXG4gICAgICB2YWx1ZSA9IHZhbHVlICsgMTtcclxuICAgICAgJChpbnB1dCkudmFsKHZhbHVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhbHVlID0gdmFsdWUgLSAxO1xyXG4gICAgICAkKGlucHV0KS52YWwodmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwcmljZVN1bW0gPSBhYmMyKHByaWNlICogdmFsdWUpO1xyXG5cclxuICAgICQoJyNwcmljZS1zdW1tJykudGV4dChwcmljZVN1bW0pO1xyXG5cclxuICB9KVxyXG5cclxuXHJcbiAgJCgnLnByb2plY3QtZm9ybV9fYWN0aW9uLWxhYmVsJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuXHJcbiAgICB2YXIgcGFyZW50ID0gJCh0aGlzKS5wYXJlbnQoKTtcclxuICAgIHZhciBjaGVjayA9ICQocGFyZW50KS5maW5kKCcucHJvamVjdC1mb3JtX19hY3Rpb24tY2hlY2snKTtcclxuXHJcbiAgICBpZiAoICQoY2hlY2spLnByb3AoXCJjaGVja2VkXCIpICkge1xyXG4gICAgICAkKHRoaXMpLnRleHQoJ9CU0L7QsdCw0LLQuNGC0YwnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICQodGhpcykudGV4dCgn0JTQvtCx0LDQstC70LXQvdC+Jyk7XHJcbiAgICB9XHJcblxyXG4gIH0pO1xyXG5cclxufSk7IiwiJCh3aW5kb3cpLmxvYWQoZnVuY3Rpb24oKSB7XHJcblxyXG4gIGZ1bmN0aW9uIHJhdGlvUGhvdG8oYmxvY2spIHtcclxuICAgICQoYmxvY2spLmVhY2goZnVuY3Rpb24oKXtcclxuICAgICAgdmFyIGl0ZW1XaWR0aCA9ICQodGhpcykud2lkdGgoKTtcclxuICAgICAgdmFyIGl0ZW1IZWlnaHQgPSAkKHRoaXMpLmhlaWdodCgpO1xyXG4gICAgICB2YXIgaXRlbVJhdGlvID0gaXRlbUhlaWdodCAvIGl0ZW1XaWR0aDtcclxuXHJcbiAgICAgIHZhciBwaG90byA9ICQodGhpcykuZmluZCgnaW1nJyk7XHJcbiAgICAgIHZhciBwaG90b1dpZHRoID0gcGhvdG8ud2lkdGgoKTtcclxuICAgICAgdmFyIHBob3RvSGVpZ2h0ID0gcGhvdG8uaGVpZ2h0KCk7XHJcbiAgICAgIHZhciBwaG90b1JhdGlvID0gcGhvdG9IZWlnaHQgLyBwaG90b1dpZHRoO1xyXG5cclxuICAgICAgaWYgKCBpdGVtUmF0aW8gPCBwaG90b1JhdGlvICkge1xyXG4gICAgICAgIHBob3RvLndpZHRoKCcxMDAlJyk7XHJcbiAgICAgICAgcGhvdG8uaGVpZ2h0KCdhdXRvJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoaXRlbVJhdGlvID4gcGhvdG9SYXRpbykge1xyXG4gICAgICAgIHBob3RvLmhlaWdodCgnMTAwJScpO1xyXG4gICAgICAgIHBob3RvLndpZHRoKCdhdXRvJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGhvdG8ud2lkdGgoJzEwMCUnKTtcclxuICAgICAgICBwaG90by5oZWlnaHQoJ2F1dG8nKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiByYXRpb0xldHRlcihibG9jaykge1xyXG4gICAgJChibG9jaykuZWFjaChmdW5jdGlvbigpe1xyXG4gICAgICB2YXIgaXRlbVdpZHRoID0gJCh0aGlzKS53aWR0aCgpO1xyXG4gICAgICB2YXIgaXRlbUhlaWdodCA9ICQodGhpcykuaGVpZ2h0KCk7XHJcbiAgICAgIHZhciBpdGVtUmF0aW8gPSBpdGVtSGVpZ2h0IC8gaXRlbVdpZHRoO1xyXG5cclxuICAgICAgdmFyIHBob3RvID0gJCh0aGlzKS5maW5kKCdpbWcnKTtcclxuICAgICAgdmFyIHBob3RvV2lkdGggPSBwaG90by53aWR0aCgpO1xyXG4gICAgICB2YXIgcGhvdG9IZWlnaHQgPSBwaG90by5oZWlnaHQoKTtcclxuICAgICAgdmFyIHBob3RvUmF0aW8gPSBwaG90b0hlaWdodCAvIHBob3RvV2lkdGg7XHJcblxyXG4gICAgICBpZiAoIGl0ZW1SYXRpbyA+IHBob3RvUmF0aW8gKSB7XHJcbiAgICAgICAgcGhvdG8ud2lkdGgoJzEwMCUnKTtcclxuICAgICAgfSBlbHNlIGlmIChpdGVtUmF0aW8gPCBwaG90b1JhdGlvKSB7XHJcbiAgICAgICAgcGhvdG8uaGVpZ2h0KCcxMDAlJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGhvdG8ud2lkdGgoJzEwMCUnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByYXRpb1Bob3RvKCcucmV2aWV3X19zbGlkZXItcHJldmlldy1pdGVtJyk7XHJcbiAgcmF0aW9QaG90bygnLnJldmlld19fc2xpZGVyLWJpZy1pdGVtJyk7XHJcbiAgcmF0aW9MZXR0ZXIoJy5yZXZpZXdfX2xldHRlci1ib3gnKTtcclxuICByYXRpb0xldHRlcignLnJldmlld19fY2hhcnQtYm94Jyk7XHJcbiAgcmF0aW9QaG90bygnLmdhbGxlcnlfX2l0ZW0nKTtcclxuICByYXRpb1Bob3RvKCcucHJvamVjdC1jYXJkX19waG90bycpO1xyXG4gIHJhdGlvUGhvdG8oJy5yZXZpZXctY2FyZF9fdmlzdWFsJyk7XHJcbiAgcmF0aW9QaG90bygnLnByb2plY3RfX3Bob3RvJyk7XHJcblxyXG4gICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKXtcclxuICAgIHJhdGlvUGhvdG8oJy5yZXZpZXdfX3NsaWRlci1wcmV2aWV3LWl0ZW0nKTtcclxuICAgIHJhdGlvUGhvdG8oJy5yZXZpZXdfX3NsaWRlci1iaWctaXRlbScpO1xyXG4gICAgcmF0aW9MZXR0ZXIoJy5yZXZpZXdfX2xldHRlci1ib3gnKTtcclxuICAgIHJhdGlvTGV0dGVyKCcucmV2aWV3X19jaGFydC1ib3gnKTtcclxuICAgIHJhdGlvUGhvdG8oJy5nYWxsZXJ5X19pdGVtJyk7XHJcbiAgICByYXRpb1Bob3RvKCcucHJvamVjdC1jYXJkX19waG90bycpO1xyXG4gICAgcmF0aW9QaG90bygnLnJldmlldy1jYXJkX192aXN1YWwnKTtcclxuICAgIHJhdGlvUGhvdG8oJy5wcm9qZWN0X19waG90bycpO1xyXG4gIH0pO1xyXG5cclxufSk7IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuXHJcbiAgJCgnLnJldmlld19fc2xpZGVyLWJpZycpLnNsaWNrKHtcclxuICAgIHNsaWRlc1RvU2hvdzogMSxcclxuICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxyXG4gICAgYXJyb3dzOiBmYWxzZSxcclxuICAgIGZhZGU6IHRydWUsXHJcbiAgICBhc05hdkZvcjogJy5yZXZpZXdfX3NsaWRlci1wcmV2aWV3J1xyXG4gIH0pO1xyXG5cclxuICAkKCcucmV2aWV3X19zbGlkZXItcHJldmlldycpLnNsaWNrKHtcclxuICAgIHNsaWRlc1RvU2hvdzogNCxcclxuICAgIHNsaWRlc1RvU2Nyb2xsOiAxLFxyXG4gICAgYXNOYXZGb3I6ICcucmV2aWV3X19zbGlkZXItYmlnJyxcclxuICAgIGRvdHM6IGZhbHNlLFxyXG4gICAgY2VudGVyTW9kZTogZmFsc2UsXHJcbiAgICBmb2N1c09uU2VsZWN0OiB0cnVlLFxyXG4gICAgcmVzcG9uc2l2ZTogW1xyXG4gICAgICB7XHJcbiAgICAgICAgYnJlYWtwb2ludDogMTIwMCxcclxuICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgc2xpZGVzVG9TaG93OiAyXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICBdXHJcbiAgfSk7XHJcblxyXG59KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xyXG4gIC8vINCf0L7Qu9C30YPQvdC+0Log0LTQu9GPINGE0L7RgNC8XHJcbiAgXHJcbiAgZnVuY3Rpb24gc2xpZGVyRm9ybSggaW5wdXRTdGFydCwgaW5wdXRFbmQsIGlkU2xpZGVyLCBkYXRhU3RhcnQsIGRhdGFFbmQgKSB7XHJcbiAgICB2YXIgcHJpY2VTdGFydCA9ICQoaW5wdXRTdGFydCkuZGF0YSggZGF0YVN0YXJ0ICk7XHJcbiAgICB2YXIgcHJpY2VFbmQgPSAkKGlucHV0RW5kKS5kYXRhKCBkYXRhRW5kICk7XHJcblxyXG4gICAgJCggaWRTbGlkZXIgKS5zbGlkZXIoe1xyXG4gICAgICAvLyBvcmllbnRhdGlvbjogXCJ2ZXJ0aWNhbFwiLFxyXG4gICAgICAvLyBzdGVwOiAxNSxcclxuICAgICAgcmFuZ2U6IHRydWUsXHJcbiAgICAgIG1pbjogcHJpY2VTdGFydCxcclxuICAgICAgbWF4OiBwcmljZUVuZCxcclxuICAgICAgdmFsdWVzOiBbIHByaWNlU3RhcnQsIHByaWNlRW5kIF0sXHJcbiAgICAgIHNsaWRlOiBmdW5jdGlvbiggZXZlbnQsIHVpICkge1xyXG4gICAgICAgICQoIGlucHV0U3RhcnQgKS52YWwoIHVpLnZhbHVlc1sgMCBdICk7XHJcbiAgICAgICAgJCggaW5wdXRFbmQgKS52YWwoIHVpLnZhbHVlc1sgMSBdICk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgJCggaW5wdXRTdGFydCApLnZhbCggJCggaWRTbGlkZXIgKS5zbGlkZXIoIFwidmFsdWVzXCIsIDAgKSApO1xyXG4gICAgJCggaW5wdXRFbmQgKS52YWwoICQoIGlkU2xpZGVyICkuc2xpZGVyKCBcInZhbHVlc1wiLCAxICkgKTtcclxuXHJcbiAgICAvLyDQmNC30LzQtdC90LXQvdC40LUg0LzQtdGB0YLQvtC/0L7Qu9C+0LbQtdC90LjRjyDQv9C+0LvQt9GD0L3QutCwINC/0YDQuCDQstCy0L7QtNC40LTQtSDQtNCw0L3QvdGL0YUg0LIg0L/QtdGA0LLRi9C5INGN0LvQtdC80LXQvdGCIGlucHV0XHJcbiAgICAkKCBpbnB1dFN0YXJ0ICkuY2hhbmdlKGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZhciB2YWx1ZTE9JCggaW5wdXRTdGFydCApLnZhbCgpO1xyXG4gICAgICB2YXIgdmFsdWUyPSQoIGlucHV0RW5kICkudmFsKCk7XHJcblxyXG4gICAgICBpZiAocGFyc2VJbnQodmFsdWUxKSA+IHBhcnNlSW50KHZhbHVlMikpe1xyXG4gICAgICAgIHZhbHVlMSA9IHZhbHVlMjtcclxuICAgICAgICAkKCBpbnB1dFN0YXJ0ICkudmFsKHZhbHVlMSk7XHJcbiAgICAgIH1cclxuICAgICAgJChpZFNsaWRlcikuc2xpZGVyKFwidmFsdWVzXCIsMCx2YWx1ZTEpOyBcclxuICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgLy8g0JjQt9C80LXQvdC10L3QuNC1INC80LXRgdGC0L7Qv9C+0LvQvtC20LXQvdC40Y8g0L/QvtC70LfRg9C90LrQsCDQv9GA0Lgg0LLQstC+0LTQuNC00LUg0LTQsNC90L3Ri9GFINCyINCy0YLQvtGA0L7QuSDRjdC70LXQvNC10L3RgiBpbnB1dCAgXHJcbiAgICAkKCBpbnB1dEVuZCApLmNoYW5nZShmdW5jdGlvbigpe1xyXG4gICAgICB2YXIgdmFsdWUxPSQoIGlucHV0U3RhcnQgKS52YWwoKTtcclxuICAgICAgdmFyIHZhbHVlMj0kKCBpbnB1dEVuZCApLnZhbCgpO1xyXG5cclxuICAgICAgaWYocGFyc2VJbnQodmFsdWUxKSA+IHBhcnNlSW50KHZhbHVlMikpe1xyXG4gICAgICAgIHZhbHVlMiA9IHZhbHVlMTtcclxuICAgICAgICAkKCBpbnB1dEVuZCApLnZhbCh2YWx1ZTIpO1xyXG4gICAgICB9XHJcbiAgICAgICQoaWRTbGlkZXIpLnNsaWRlcihcInZhbHVlc1wiLDEsdmFsdWUyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vINGE0LjQu9GM0YLRgNCw0YbQuNGPINCy0LLQvtC00LAg0LIg0L/QvtC70Y9cclxuICAgIGpRdWVyeSgnI2Ftb3VudF9zdGFydCwgI2Ftb3VudF9lbmQnKS5rZXlwcmVzcyhmdW5jdGlvbihldmVudCl7XHJcbiAgICAgIHZhciBrZXksIGtleUNoYXI7XHJcbiAgICAgIGlmKCFldmVudCkgdmFyIGV2ZW50ID0gd2luZG93LmV2ZW50O1xyXG4gICAgICBcclxuICAgICAgaWYgKGV2ZW50LmtleUNvZGUpIGtleSA9IGV2ZW50LmtleUNvZGU7XHJcbiAgICAgIGVsc2UgaWYoZXZlbnQud2hpY2gpIGtleSA9IGV2ZW50LndoaWNoO1xyXG4gICAgXHJcbiAgICAgIGlmKGtleT09bnVsbCB8fCBrZXk9PTAgfHwga2V5PT04IHx8IGtleT09MTMgfHwga2V5PT05IHx8IGtleT09NDYgfHwga2V5PT0zNyB8fCBrZXk9PTM5ICkgcmV0dXJuIHRydWU7XHJcbiAgICAgIGtleUNoYXI9U3RyaW5nLmZyb21DaGFyQ29kZShrZXkpO1xyXG4gICAgICBcclxuICAgICAgaWYoIS9cXGQvLnRlc3Qoa2V5Q2hhcikpIHJldHVybiBmYWxzZTtcclxuICAgIFxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgc2xpZGVyRm9ybSgnLnByb2plY3RzLWZpbHRlcl9fY29zdC0tc3RhcnQnLCAnLnByb2plY3RzLWZpbHRlcl9fY29zdC0tZW5kJywgJyNwcm9qZWN0LXNsaWRlci11aScsICdwcm9qLXN0YXJ0JywgJ3Byb2otZW5kJyk7XHJcbiAgc2xpZGVyRm9ybSgnLmZvcm1fX2Nvc3QtLXN0YXJ0JywgJy5mb3JtX19jb3N0LS1lbmQnLCAnI2Zvcm0tc2xpZGVyLXVpJywgJ3ByaWNlLXN0YXJ0JywgJ3ByaWNlLWVuZCcpO1xyXG5cclxufSk7IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuXHJcbiAgZnVuY3Rpb24gdGVsTWFzayhzZWxlY3Rvcikge1xyXG4gICAgJChzZWxlY3RvcikubWFzaygnKzcgKDAwMCkgMDAwLTAwLTAwJyk7XHJcbiAgfVxyXG5cclxuICB0ZWxNYXNrKCcuY29udGFjdC1mb3JtX19pbnB1dC0tdGVsJyk7XHJcbiAgdGVsTWFzaygnLmNvbnN1bHRfX2lucHV0LXRlbCcpO1xyXG5cclxufSk7Il19
